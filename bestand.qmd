---
title: "Bestand"
subtitle: "Bestandsanalyse und Fachgebietsverteilung"
author: "Thomas Gerdes [![ORCID](https://orcid.org/sites/default/files/images/orcid_16x16.png)](https://orcid.org/0000-0001-8524-5987){target=\"_blank\"}"
date: "2025-08-15"
format:
  html:
    toc: true
    toc-float: true
    code-fold: true
    interactive: true
    embed-resources: false
    page-layout: full
    lang: de
    include-in-header:
      - text: |
          <meta name="author" content="Thomas Gerdes">
          <meta name="description" content="Comprehensive collection analysis for MPI library including subject distribution">
          <meta name="keywords" content="library, collection, subjects, statistics, MPI, print books, distribution">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
          <script src="shared/data.js"></script>
          <script src="shared/functions.js"></script>
---

::: {style="height: 40px;"}
:::

```{=html}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="shared/data.js"></script>
<script src="shared/functions.js"></script>

<style>
/* Seitenspezifische Styles - alle gemeinsamen Styles sind in shared/styles.css */
</style>
```

## Bestandsentwicklung 2000-2024 (Print-Bücher)

```{=html}
<div class="chart-container">

  <div class="info-box-container" style="margin: 15px 0;">
  <div class="info-box blue">
    <div class="info-box-value" id="currentStockPrint" aria-live="polite">-</div>
    <div class="info-box-label">Bestand 31.12.2024</div>
  </div>
</div>

  <div style="margin: 15px 0; display: flex; gap: 8px; justify-content: center;">
    <button id="lineBtnStock" onclick="changeChartTypeStock('line')" 
            aria-label="Wechsel zu Liniendiagramm für Bestandsentwicklung"
            class="dashboard-button" 
            style="background: #28a745;">Liniendiagramm</button>
    <button id="barBtnStock" onclick="changeChartTypeStock('bar')" 
            aria-label="Wechsel zu Balkendiagramm für Bestandsentwicklung"
            class="dashboard-button" 
            style="background: #007bff;">Balkendiagramm</button>
    <button onclick="downloadChartStock()" 
            aria-label="Diagramm der Bestandsentwicklung als PNG-Datei herunterladen"
            class="dashboard-button" 
            style="background: #28a745;">PNG Download</button>
  </div>

  <div style="position: relative; height: 600px; margin: 10px 0;">
    <canvas id="stockChart" role="img" aria-label="Diagramm der Bestandsentwicklung Print-Bücher von 2000 bis 2024"></canvas>
  </div>
</div>

<p>Im Jahr 2008 wurden aus dem Bestand des MPI für Geschichte 8.096 Print-Bücher in die Bibliothek des MPI-MMG übernommen. Das entspricht ca. 7 Prozent des vormaligen Gestamtbestands.</p>

<details id="detailsStock">
<summary>Detaildaten zur Bestandsentwicklung (Print-Bücher)</summary>
<div class="details-content">
</div>
</details>
```

::: {style="height: 40px;"}
:::

------------------------------------------------------------------------

## Bestandsverteilung nach Fachgebieten (Print-Bücher)

```{=html}
<div class="chart-container">
  
  <div style="display: flex; justify-content: center; margin: 15px 0;">
    <div class="info-box blue" style="flex: none;">
      <div class="info-box-value" id="totalBooks" aria-live="polite">-</div>
      <div class="info-box-label">Bestand 15.08.2025</div>
    </div>
  </div>

  <div style="margin: 15px 0; display: flex; gap: 8px; justify-content: center;">
    <button id="pieBtn2" onclick="changeChartType2('pie')" 
            aria-label="Wechsel zu Kreisdiagramm für Bestandsverteilung"
            class="dashboard-button" 
            style="background: #28a745;">Kreisdiagramm</button>
    <button id="barBtn2" onclick="changeChartType2('bar')" 
            aria-label="Wechsel zu Balkendiagramm für Bestandsverteilung"
            class="dashboard-button" 
            style="background: #007bff;">Balkendiagramm</button>
    <button onclick="downloadChart2()" 
            aria-label="Diagramm der Bestandsverteilung als PNG-Datei herunterladen"
            class="dashboard-button" 
            style="background: #28a745;">PNG Download</button>
  </div>

  <div style="position: relative; height: 700px; margin: 10px 0;">
    <canvas id="subjectChart" role="img" aria-label="Diagramm der Bestandsverteilung nach Fachgebieten"></canvas>
  </div>
</div>

<details id="details2">
<summary>Detaildaten zur Bestandsaufschlüsselung (Print-Bücher)</summary>
<div class="details-content">
</div>
</details>
```

::: {style="height: 40px;"}
:::

------------------------------------------------------------------------

## Bestandsverteilung nach Fachgebieten (Ebooks)

<p>Die fachliche Verteilung der Ebooks lässt sich aus den Daten nicht direkt ermitteln, da Ebooks im Gegensatz zu gedruckten Büchern keine fachgebietsspezifischen Signaturen erhalten. Die Erwerbungshistorie deutet jedoch darauf hin, dass die thematische Aufteilung der Ebooks weitgehend der des Printbestands entspricht und somit ebenfalls einen klaren Schwerpunkt im Bereich der Sozial- und Kulturanthropologie aufweist.</p>

::: {style="height: 40px;"}
:::

------------------------------------------------------------------------

## Gesamtbestand

```{=html}
<div class="chart-container">
  
  <div style="display: flex; justify-content: center; margin: 15px 0;">
    <div class="info-box blue" style="flex: none;">
      <div class="info-box-value" id="totalCollection" aria-live="polite">-</div>
      <div class="info-box-label">Gesamtbestand 15.08.2025</div>
    </div>
  </div>

  <div style="margin: 15px 0; display: flex; gap: 8px; justify-content: center;">
    <button id="pieBtn3" onclick="changeChartType3('pie')" 
            aria-label="Wechsel zu Kreisdiagramm für Gesamtbestand"
            class="dashboard-button" 
            style="background: #28a745;">Kreisdiagramm</button>
    <button id="barBtn3" onclick="changeChartType3('bar')" 
            aria-label="Wechsel zu Balkendiagramm für Gesamtbestand"
            class="dashboard-button" 
            style="background: #007bff;">Balkendiagramm</button>
    <button onclick="downloadChart3()" 
            aria-label="Diagramm des Gesamtbestands als PNG-Datei herunterladen"
            class="dashboard-button" 
            style="background: #28a745;">PNG Download</button>
  </div>

  <div style="position: relative; height: 500px; margin: 10px 0;">
    <canvas id="totalCollectionChart" role="img" aria-label="Diagramm des Gesamtbestands nach Medientypen"></canvas>
  </div>
</div>

<details id="details3">
<summary>Detaildaten zur Bestandsaufschlüsselung</summary>
<div class="details-content">
</div>
</details>

<script>
// Chart instances and state variables
let chartStock, chart2, chart3;
let currentChartTypeStock = 'line';
let currentChartType2 = 'pie';
let currentChartType3 = 'pie';

// ===== STOCK DEVELOPMENT CHART =====
function initChartStock(type = 'line') {
  const ctx = document.getElementById('stockChart').getContext('2d');
  
  if (chartStock) { 
    chartStock.destroy(); 
  }

  currentChartTypeStock = type;
  updateActiveButtons(type, 'lineBtnStock', 'barBtnStock');

  const config = getStandardChartConfig(type, {
    labels: STOCK_DATA.map(d => d.year),
    datasets: [
      {
        label: 'Print-Bücher Bestand',
        data: STOCK_DATA.map(d => d.value),
        borderColor: '#007bff',
        backgroundColor: type === 'bar' ? '#007bff' : '#007bff20',
        borderWidth: 3,
        pointRadius: type === 'line' ? 4 : 0,
        fill: type === 'line'
      }
    ]
  }, {
    scales: {
      y: { 
        title: { display: true, text: 'Bestand (Anzahl Bücher)', font: { size: 12 } }
      }
    }
  });
  
  chartStock = new Chart(ctx, config);
  announceToScreenReader(`Bestandsentwicklungsdiagramm als ${type === 'line' ? 'Liniendiagramm' : 'Balkendiagramm'} geladen`);
}

function changeChartTypeStock(type) { 
  initChartStock(type); 
}

function downloadChartStock() {
  downloadChart(chartStock, 'bestandsentwicklung_2000-2024.png', 'Bestandsentwicklungsdiagramm');
}

// ===== SUBJECT DISTRIBUTION CHART =====
function initChart2(type = 'pie') {
  const ctx = document.getElementById('subjectChart').getContext('2d');
  
  if (chart2) { 
    chart2.destroy(); 
  }

  currentChartType2 = type;
  updateActiveButtons(type, null, 'barBtn2', 'pieBtn2');

  const colors = [
    '#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8', 
    '#6f42c1', '#fd7e14', '#20c997', '#6c757d', '#e83e8c',
    '#007bff80', '#28a74580', '#dc354580', '#ffc10780', '#17a2b880',
    '#6f42c180', '#fd7e1480', '#20c99780', '#007bff40', '#28a74540', '#dc354540'
  ];

  const sortedData = [...SUBJECT_DATA].sort((a, b) => b.count - a.count);
  
  // Create mapping for consistent colors
  const indexMapping = {};
  SUBJECT_DATA.forEach((item, index) => {
    indexMapping[`${item.signature}-${item.name}`] = index;
  });
  
  const colorsToUse = sortedData.map(item => {
    const originalIndex = indexMapping[`${item.signature}-${item.name}`];
    return colors[originalIndex];
  });

  const config = {
    type: type,
    data: {
      labels: sortedData.map(d => `${d.signature} - ${d.name}`),
      datasets: [{
        label: 'Anzahl Bücher',
        data: sortedData.map(d => d.count),
        backgroundColor: colorsToUse,
        borderColor: colorsToUse.map(color => color.replace('80', '').replace('40', '')),
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      accessibility: {
        announceNewData: {
          enabled: true
        }
      },
      layout: { padding: { bottom: type === 'bar' ? 60 : 20, left: 10, right: 10, top: 10 } },
      plugins: {
        legend: {
          display: type === 'pie',
          position: 'bottom',
          labels: { boxWidth: 12, padding: 8, font: { size: 9 }, usePointStyle: true }
        },
        tooltip: {
          callbacks: {
            title: context => null,
            label: context => {
              const count = type === 'bar' ? context.parsed.y : context.parsed;
              const percentage = ((count / TOTAL_BOOKS) * 100).toFixed(1);
              const item = sortedData[context.dataIndex];
              return `${item.signature} - ${item.name}: ${count.toLocaleString('de-DE')} (${percentage}%)`;
            }
          }
        }
      },
      scales: type === 'bar' ? {
        x: {
          title: { display: true, text: 'Signaturgruppe', font: { size: 12 } },
          ticks: {
            maxRotation: 45,
            minRotation: 45,
            font: { size: 8 },
            callback: (value, index) => {
              const item = sortedData[index];
              if (item) { 
                const label = `${item.signature} - ${item.name}`; 
                return label.length > 25 ? label.substr(0, 22) + '...' : label; 
              }
              return value;
            }
          }
        },
        y: { 
          title: { display: true, text: 'Anzahl Bücher', font: { size: 12 } }, 
          beginAtZero: true, 
          ticks: { font: { size: 10 } } 
        }
      } : {}
    }
  };
  
  chart2 = new Chart(ctx, config);
  announceToScreenReader(`Bestandsdiagramm als ${type === 'pie' ? 'Kreisdiagramm' : 'Balkendiagramm'} geladen`);
}

function changeChartType2(type) { 
  initChart2(type); 
}

function downloadChart2() {
  downloadChart(chart2, 'bestand_sachgruppen_2025.png', 'Bestandsdiagramm');
}

// ===== TOTAL COLLECTION CHART =====
function initChart3(type = 'pie') {
  const ctx = document.getElementById('totalCollectionChart').getContext('2d');
  
  if (chart3) { 
    chart3.destroy(); 
  }

  currentChartType3 = type;
  updateActiveButtons(type, null, 'barBtn3', 'pieBtn3');

  const collectionColors = ['#007bff', '#28a745', '#17a2b8'];
  
  const collectionData = [
    { name: 'Print-Bücher', count: TOTAL_BOOKS }, 
    { name: 'Ebooks', count: TOTAL_EBOOKS },
    ...OTHER_MEDIA_DATA
  ];

  const dataToUse = type === 'bar' ? 
    [...collectionData].sort((a, b) => b.count - a.count) : 
    collectionData;

  const config = {
    type: type,
    data: {
      labels: dataToUse.map(d => d.name),
      datasets: [{
        label: 'Anzahl Medien',
        data: dataToUse.map(d => d.count),
        backgroundColor: collectionColors,
        borderColor: collectionColors,
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      accessibility: {
        announceNewData: {
          enabled: true
        }
      },
      layout: { padding: { bottom: type === 'bar' ? 40 : 20, left: 10, right: 10, top: 10 } },
      plugins: {
        legend: {
          display: type === 'pie',
          position: 'bottom',
          labels: { boxWidth: 15, padding: 15, font: { size: 12 }, usePointStyle: true }
        },
        tooltip: {
          callbacks: {
            title: context => null,
            label: context => {
              const count = type === 'bar' ? context.parsed.y : context.parsed;
              const percentage = ((count / TOTAL_COLLECTION) * 100).toFixed(1);
              const item = dataToUse[context.dataIndex];
              return `${item.name}: ${count.toLocaleString('de-DE')} (${percentage}%)`;
            }
          }
        }
      },
      scales: type === 'bar' ? {
        x: { 
          title: { display: true, text: 'Medientyp', font: { size: 12 } }, 
          ticks: { font: { size: 11 } } 
        },
        y: { 
          title: { display: true, text: 'Anzahl Medien', font: { size: 12 } }, 
          beginAtZero: true, 
          ticks: { font: { size: 10 } } 
        }
      } : {}
    }
  };
  
  chart3 = new Chart(ctx, config);
  announceToScreenReader(`Gesamtbestandsdiagramm als ${type === 'pie' ? 'Kreisdiagramm' : 'Balkendiagramm'} geladen`);
}

function changeChartType3(type) { 
  initChart3(type); 
}

function downloadChart3() {
  downloadChart(chart3, 'gesamtbestand_2025.png', 'Gesamtbestandsdiagramm');
}

// ===== UPDATE STATISTICS =====
function updateStockStats() {
  document.getElementById('currentStockPrint').textContent = formatNumber(CURRENT_STOCK);
}

function updateSubjectStats() {
  document.getElementById('totalBooks').textContent = formatNumber(TOTAL_BOOKS);
}

function updateCollectionStats() {
  document.getElementById('totalCollection').textContent = formatNumber(TOTAL_COLLECTION);
}

// ===== GENERATE TABLES =====
function generateTableStock() {
  const columns = [
    { field: 'year', title: 'Jahr' },
    { field: 'value', title: 'Bestand Print-Bücher', formatter: formatNumber }
  ];
  return generateTable(STOCK_DATA, columns, {
    className: 'table table-striped table-hover',
    ariaLabel: 'Detaildaten der Bestandsentwicklung nach Jahren'
  });
}

function generateTable2() {
  const columns = [
    { field: 'signature', title: 'Signatur' },
    { field: 'name', title: 'Fachgebiet' },
    { field: 'count', title: 'Anzahl', formatter: formatNumber },
    { 
      field: 'count', 
      title: 'Anteil', 
      formatter: (value) => ((value / TOTAL_BOOKS) * 100).toFixed(1) + '%'
    }
  ];
  return generateTable(SUBJECT_DATA, columns, {
    sortBy: 'count',
    sortDesc: true,
    className: 'table table-striped table-hover',
    ariaLabel: 'Detaillierte Bestandsaufschlüsselung nach Fachgebieten'
  });
}

function generateTable3() {
  const collectionData = [
    { name: 'Print-Bücher', count: TOTAL_BOOKS }, 
    { name: 'Ebooks', count: TOTAL_EBOOKS },
    ...OTHER_MEDIA_DATA
  ];

  const columns = [
    { field: 'name', title: 'Medientyp' },
    { field: 'count', title: 'Anzahl', formatter: formatNumber },
    { 
      field: 'count', 
      title: 'Anteil', 
      formatter: (value) => ((value / TOTAL_COLLECTION) * 100).toFixed(1) + '%'
    }
  ];
  return generateTable(collectionData, columns, {
    className: 'table table-striped table-hover',
    ariaLabel: 'Gesamtbestand nach Medientypen'
  });
}

function initTables() {
  try {
    document.querySelector('#detailsStock .details-content').innerHTML = generateTableStock();
    document.querySelector('#details2 .details-content').innerHTML = generateTable2();
    document.querySelector('#details3 .details-content').innerHTML = generateTable3();
    console.log('Collection tables initialized successfully');
  } catch (error) {
    console.error('Error initializing collection tables:', error);
  }
}

// ===== INITIALIZATION =====
function initializeCollection() {
  try {
    console.log('Initializing Collection Dashboard...');
    
    // Update all statistics
    updateStockStats();
    updateSubjectStats();
    updateCollectionStats();
    
    // Initialize all charts
    initChartStock();
    initChart2();
    initChart3();
    
    // Initialize tables
    initTables();
    
    // Initialize common dashboard functionality
    initDashboard([chartStock, chart2, chart3]);
    
    console.log('Collection initialization complete');
    
  } catch (error) {
    console.error('Collection initialization failed:', error);
    announceToScreenReader('Fehler beim Laden der Bestandsanalyse');
  }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeCollection);
} else {
  initializeCollection();
}

// Fallback initialization
window.addEventListener('load', function() {
  if (!chartStock || !chart2 || !chart3) {
    console.log('Re-initializing collection charts...');
    initializeCollection();
  }
});
</script>
```